{"version":3,"file":"chunks/browser/lite/587.8fb9e11eac5a454c5a9f.js","mappings":";;;;;;;;;;;;;;AAA0E;AACnE;AACP;AACA;AACA;AACA;AACA;AACO;AACP;AACA;AACA;AACA;AACA,cAAc,qDAAkB;AAChC;AACA,KAAK;AACL;AACO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,cAAc,qDAAkB;AAChC;AACA,oCAAoC,8DAA2B;AAC/D,KAAK;AACL;AACO;AACP;AACA,cAAc,qDAAkB;AAChC;AACA;AACA;AACA;AACA;AACA,SAAS;AACT,KAAK;AACL;;;;;;;;;;;;;;ACxCA;AACA;AACA;AACO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC,oDAAoD;AACrD;AACA;AACA;AACO;AACP;AACA;AACA;AACA;AACA,CAAC,gDAAgD;AAC1C;AACP;AACA;AACA,CAAC,kEAAkE;AAC5D;AACP;AACA;AACA,CAAC,0CAA0C;;;;;;;;;;;;;;;;;;;;;AC7B6E;AACxH,yEAAyE,IAAI;AAC7E;AACA;AACA;AACA;AACO;AACP,yBAAyB,2BAAU,sBAAsB,0BAAS;AAClE;AACA;AACA;AACA;AACA,gBAAgB,8CAA6B;AAC7C,0BAA0B,uCAAsB;AAChD;AACA;AACA;AACA;;;;;;;ACjBuF;AAC4C;AACzF;AACnC;AACP;AACA,QAAQ,2CAA8B;AACtC;AACA;AACA,QAAQ,yCAA4B;AACpC;AACA;AACO;AACP,QAAQ,yBAAQ;AAChB;AACA;AACA,+CAA+C,oBAAe,uBAAuB,UAAU,sBAAsB;AACrH;AACA;AACO,8BAA8B,qCAAqC;AAC1E;AACA,8BAA8B,sCAAqB;AACnD;AACA;AACA;AACA,4BAA4B,8CAA6B;AACzD;AACA;AACA;AACO,mCAAmC,8BAA8B;AACxE,2DAA2D,qCAAoB;AAC/E;AACA;AACA,oEAAoE;AACpE;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,2BAA2B,qCAAoB;AAC/C;AACA;AACA;AACO;AACP,8BAA8B,qCAAoB;AAClD;AACA;AACA;;;AClD8C;AACC;AAC2F;AACnI,+BAA+B,4CAA4C;AAClF,oCAAoC,mBAAS;AAC7C;AACA;AACA;AACA,aAAa,yBAAoB;AACjC,YAAY,kBAAkB;AAC9B;AACA,aAAa,yBAAoB;AACjC,aAAa,yBAAoB;AACjC,YAAY,kBAAkB;AAC9B;AACA;AACA;AACA,aAAa;AACb;AACA,aAAa,yBAAoB;AACjC,YAAY,uBAAuB;AACnC;AACA;AACA,aAAa;AACb;AACA,aAAa,yBAAoB;AACjC,YAAY,uBAAuB;AACnC;AACA,aAAa,yBAAoB;AACjC,YAAY,MAAM;AAClB;AACA;AACA;;;AChCkI;AAClF;AACF;AACuB;AACrE;AACA;AACA;AACA;AACA;AACO;AACP;AACA,QAAQ,wBAAc;AACtB,QAAQ,YAAY,cAAc,sCAAqB;AACvD;AACA;AACA,2DAA2D,qCAAoB;AAC/E;AACA,oEAAoE;AACpE;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa,mCAAkB;AAC/B;AACA;AACA,QAAQ,mBAAmB;AAC3B;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA,2BAA2B,sCAAqB;AAChD;;;AC1CgE;AAChB;AACI;AACpD;AACA;AACA;AACA;AACO;AACP,IAAI,wBAAc;AAClB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,kCAAkC,qCAAoB;AACtD;AACA,YAAY,eAAe;AAC3B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AC/BO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AClC4Q;AACrN;AACuB;AAC1B;AACgB;AACtB;AAC9C;AACA;AACA;AACA;AACA;AACO;AACP,SAAS,mBAAS;AAClB;AACA;AACA,IAAI,oBAAU;AACd;AACA,aAAa,gCAAe,GAAG,sCAAqB;AACpD,aAAa,iCAAgB,GAAG,sCAAqB;AACrD,aAAa,wCAAuB,GAAG,yCAAwB;AAC/D,aAAa,yCAAwB,GAAG,yCAAwB;AAChE,aAAa,sCAAqB,GAAG,uCAAsB;AAC3D,aAAa,uCAAsB,GAAG,uCAAsB;AAC5D;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iBAAiB,mCAAkB;AACnC;AACA;AACA,oCAAoC,yBAAoB;AACxD;AACA,oBAAoB,eAAe;AACnC;AACA;AACA;AACA;AACA;AACA;AACA,QAAQ,uBAAuB;AAC/B;AACA,YAAY,eAAe;AAC3B;AACA;AACA,QAAQ,4BAA4B;AACpC,KAAK;AACL","sources":["webpack://@flagship.io/js-sdk/./src/qaAssistant/messages/index.ts","webpack://@flagship.io/js-sdk/./src/qaAssistant/type.ts","webpack://@flagship.io/js-sdk/./src/qaAssistant/appendScript.ts","webpack://@flagship.io/js-sdk/./src/qaAssistant/messages/iframeMessageActions.ts","webpack://@flagship.io/js-sdk/./src/qaAssistant/messages/handleIframeMessage.ts","webpack://@flagship.io/js-sdk/./src/qaAssistant/loadQaAssistant.ts","webpack://@flagship.io/js-sdk/./src/qaAssistant/listenForKeyboardQaAssistant.ts","webpack://@flagship.io/js-sdk/./src/qaAssistant/detectNavigationChanges.ts","webpack://@flagship.io/js-sdk/./src/qaAssistant/index.ts"],"sourcesContent":["import { MSG_NAME_TO_IFRAME, VisitorVariationUpdateParam } from '../type';\nexport function sendMessageToIframe(data) {\n    if (!window?.frames?.ABTastyQaAssistant) {\n        return;\n    }\n    window.frames.ABTastyQaAssistant.postMessage(data, '*');\n}\nexport function sendVisitorAllocatedVariations(visitorVariationState) {\n    if (!visitorVariationState?.visitorVariations) {\n        return;\n    }\n    sendMessageToIframe({\n        name: MSG_NAME_TO_IFRAME.FsUpdateVisitorAllocatedVariation,\n        value: visitorVariationState.visitorVariations\n    });\n}\nexport function sendVisitorExposedVariations(visitorVariationState) {\n    if (!visitorVariationState?.exposedVariations) {\n        return;\n    }\n    const navigationDetected = visitorVariationState.navigationDetected;\n    if (visitorVariationState.navigationDetected) {\n        visitorVariationState.navigationDetected = false;\n    }\n    sendMessageToIframe({\n        name: MSG_NAME_TO_IFRAME.FsVisitorExposedVariation,\n        value: visitorVariationState.exposedVariations,\n        param: navigationDetected ? VisitorVariationUpdateParam.NewNavigation : undefined\n    });\n}\nexport function sendFsHitToQA(hit) {\n    sendMessageToIframe({\n        name: MSG_NAME_TO_IFRAME.FsHIT,\n        value: hit.map(item => {\n            return {\n                ...item,\n                timestamp: Date.now() - item.qt\n            };\n        })\n    });\n}\n","/**\n * All events posted from iframe\n */\nexport var MSG_NAME_FROM_IFRAME;\n(function (MSG_NAME_FROM_IFRAME) {\n    MSG_NAME_FROM_IFRAME[\"QaAssistantClose\"] = \"ABTASTY_QA_ASSISTANT_CLOSE\";\n    MSG_NAME_FROM_IFRAME[\"FsApplyForcedVariations\"] = \"FS_APPLY_FORCED_VARIATIONS\";\n    MSG_NAME_FROM_IFRAME[\"FsResetForcedVariations\"] = \"FS_RESET_FORCED_VARIATIONS\";\n    MSG_NAME_FROM_IFRAME[\"FsQaAssistantReady\"] = \"FS_QA_ASSISTANT_READY\";\n    MSG_NAME_FROM_IFRAME[\"MinimizeQaAssistantClose\"] = \"ABTASTY_QA_MINIMIZE_QA_ASSISTANT_CLOSE\";\n    MSG_NAME_FROM_IFRAME[\"FsTriggerRender\"] = \"FS_TRIGGER_RENDER\";\n    MSG_NAME_FROM_IFRAME[\"QaAssistantPlatformChoiceLoaded\"] = \"ABTASTY_QA_ASSISTANT_PLATFORM_CHOICE_LOADED\";\n})(MSG_NAME_FROM_IFRAME || (MSG_NAME_FROM_IFRAME = {}));\n/**\n * All events posted to iframe\n */\nexport var MSG_NAME_TO_IFRAME;\n(function (MSG_NAME_TO_IFRAME) {\n    MSG_NAME_TO_IFRAME[\"FsUpdateVisitorAllocatedVariation\"] = \"FS_UPDATE_VISITOR_ALLOCATED_VARIATION\";\n    MSG_NAME_TO_IFRAME[\"FsVisitorExposedVariation\"] = \"FS_VISITOR_EXPOSED_VARIATION\";\n    MSG_NAME_TO_IFRAME[\"FsHIT\"] = \"FS_HIT\";\n})(MSG_NAME_TO_IFRAME || (MSG_NAME_TO_IFRAME = {}));\nexport var VisitorVariationUpdateParam;\n(function (VisitorVariationUpdateParam) {\n    VisitorVariationUpdateParam[\"NewNavigation\"] = \"newNavigation\";\n})(VisitorVariationUpdateParam || (VisitorVariationUpdateParam = {}));\nexport var INTERNAL_EVENTS;\n(function (INTERNAL_EVENTS) {\n    INTERNAL_EVENTS[\"FsTriggerRendering\"] = \"FS_TRIGGER_RENDERING\";\n})(INTERNAL_EVENTS || (INTERNAL_EVENTS = {}));\n","import { FS_QA_ASSISTANT_SCRIPT_TAG_ID, FS_QA_URL, QA_ASSISTANT_LOCAL_URL, TAG_QA_URL } from '../enum/FlagshipConstant';\nconst getScriptElement = (src) => document.querySelector(`script[src*=\"${src}\"]`);\n/**\n *\n * @param bundleFileUrl\n */\nexport function appendScript(bundleFileUrl) {\n    if (getScriptElement(TAG_QA_URL) || getScriptElement(FS_QA_URL)) {\n        return;\n    }\n    const script = document.createElement('script');\n    script.src = bundleFileUrl;\n    script.id = FS_QA_ASSISTANT_SCRIPT_TAG_ID;\n    if (bundleFileUrl === QA_ASSISTANT_LOCAL_URL) {\n        script.crossOrigin = 'anonymous';\n    }\n    document.body.append(script);\n}\n","import { sendVisitorAllocatedVariations, sendVisitorExposedVariations } from './index';\nimport { FS_FORCED_VARIATIONS, FS_IS_QA_MODE_ENABLED, FS_QA_ASSISTANT_SCRIPT_TAG_ID, SDK_INFO } from '../../enum/FlagshipConstant';\nimport { INTERNAL_EVENTS } from '../type';\nexport function onQaAssistantReady(visitorVariationState) {\n    if (visitorVariationState.visitorVariations) {\n        sendVisitorAllocatedVariations(visitorVariationState);\n    }\n    if (visitorVariationState.exposedVariations) {\n        sendVisitorExposedVariations(visitorVariationState);\n    }\n}\nexport function render(forcedReFetchFlags = false) {\n    if (SDK_INFO.name === 'TypeScript') {\n        window.location.reload();\n    }\n    const triggerRenderEvent = new CustomEvent(INTERNAL_EVENTS.FsTriggerRendering, { detail: { forcedReFetchFlags } });\n    window.dispatchEvent(triggerRenderEvent);\n}\nexport function onQaAssistantClose({ config, func, visitorVariationState }) {\n    config.isQAModeEnabled = false;\n    sessionStorage.removeItem(FS_IS_QA_MODE_ENABLED);\n    if (func) {\n        window.removeEventListener('message', func);\n    }\n    document.getElementById(FS_QA_ASSISTANT_SCRIPT_TAG_ID)?.remove();\n    visitorVariationState.forcedVariations = {};\n    render();\n}\nexport function onApplyForcedVariations({ value, visitorVariationState }) {\n    const sessionForcedVariations = sessionStorage.getItem(FS_FORCED_VARIATIONS);\n    let forcedVariations = {};\n    try {\n        forcedVariations = JSON.parse(sessionForcedVariations || '{}');\n    }\n    catch (error) {\n        // eslint-disable-next-line no-console\n        console.error('Error parsing sessionForcedVariations', error);\n    }\n    forcedVariations = {\n        ...forcedVariations,\n        ...value\n    };\n    sessionStorage.setItem(FS_FORCED_VARIATIONS, JSON.stringify(forcedVariations));\n    visitorVariationState.forcedVariations = forcedVariations;\n    render();\n}\nexport function onResetForcedVariations(visitorVariationState) {\n    sessionStorage.removeItem(FS_FORCED_VARIATIONS);\n    visitorVariationState.forcedVariations = {};\n    render();\n}\n","import { isBrowser } from '../../utils/utils';\nimport { MSG_NAME_FROM_IFRAME } from '../type';\nimport { onApplyForcedVariations, onQaAssistantClose, onQaAssistantReady, onResetForcedVariations, render } from './iframeMessageActions';\nexport function handleIframeMessage({ event, config, func, visitorVariationState }) {\n    if (!config.isQAModeEnabled || !isBrowser()) {\n        return;\n    }\n    switch (event.data.name) {\n        case MSG_NAME_FROM_IFRAME.FsQaAssistantReady:\n            onQaAssistantReady(visitorVariationState);\n            break;\n        case MSG_NAME_FROM_IFRAME.MinimizeQaAssistantClose:\n        case MSG_NAME_FROM_IFRAME.QaAssistantClose:\n            onQaAssistantClose({\n                config,\n                func,\n                visitorVariationState\n            });\n            break;\n        case MSG_NAME_FROM_IFRAME.FsApplyForcedVariations:\n            onApplyForcedVariations({\n                value: event.data.value,\n                visitorVariationState\n            });\n            break;\n        case MSG_NAME_FROM_IFRAME.FsResetForcedVariations:\n            onResetForcedVariations(visitorVariationState);\n            break;\n        case MSG_NAME_FROM_IFRAME.FsTriggerRender:\n            render(true);\n            break;\n    }\n}\n","import { FS_FORCED_VARIATIONS, FS_IS_QA_MODE_ENABLED, QA_ASSISTANT_PROD_URL, TRUSTED_QA_ORIGINS } from '../enum/FlagshipConstant';\nimport { logInfoSprintf } from '../utils/utils';\nimport { appendScript } from './appendScript';\nimport { handleIframeMessage } from './messages/handleIframeMessage';\n/**\n *\n * @param config\n * @returns\n */\nexport function loadQaAssistant(config, bundleUrl = null, visitorVariationState) {\n    if (!window?.frames?.ABTastyQaAssistant) {\n        logInfoSprintf(config, 'QA assistant', 'Loading QA Assistant');\n        appendScript(bundleUrl || QA_ASSISTANT_PROD_URL);\n    }\n    let forcedVariations = {};\n    const sessionForcedVariations = sessionStorage.getItem(FS_FORCED_VARIATIONS);\n    try {\n        forcedVariations = JSON.parse(sessionForcedVariations || '{}');\n    }\n    catch (error) {\n        // eslint-disable-next-line no-console\n        console.error('Error parsing sessionForcedVariations', error);\n    }\n    visitorVariationState.forcedVariations = forcedVariations;\n    if (window.__flagshipSdkQaAssistantMessageHandler) {\n        window.removeEventListener('message', window.__flagshipSdkQaAssistantMessageHandler);\n    }\n    const eventListenerMessage = (event) => {\n        if (!TRUSTED_QA_ORIGINS.includes(event?.origin)) {\n            return;\n        }\n        handleIframeMessage({\n            visitorVariationState,\n            event,\n            config,\n            func: eventListenerMessage\n        });\n    };\n    window.__flagshipSdkQaAssistantMessageHandler = eventListenerMessage;\n    window.addEventListener('message', window.__flagshipSdkQaAssistantMessageHandler);\n    config.isQAModeEnabled = true;\n    sessionStorage.setItem(FS_IS_QA_MODE_ENABLED, 'true');\n}\n","import { FS_FORCED_VARIATIONS } from '../enum/FlagshipConstant';\nimport { logInfoSprintf } from '../utils/utils';\nimport { loadQaAssistant } from './loadQaAssistant';\n/**\n *\n * @param config\n */\nexport function listenForKeyboardQaAssistant(config, visitorVariationState) {\n    logInfoSprintf(config, 'QA assistant', 'Listening for keyboard events to launch QA Assistant');\n    if (window.__flagshipSdkOnKeyCombinationDown) {\n        document.removeEventListener('keydown', window.__flagshipSdkOnKeyCombinationDown);\n    }\n    if (window.__flagshipSdkOnKeyCombinationUp) {\n        document.removeEventListener('keyup', window.__flagshipSdkOnKeyCombinationUp);\n    }\n    const keysPressed = {};\n    const keyCombinationPressed = () => {\n        return (keysPressed.Control || keysPressed.Alt) && keysPressed.q && keysPressed.a;\n    };\n    window.__flagshipSdkOnKeyCombinationDown = (event) => {\n        keysPressed[event.key] = true;\n        sessionStorage.removeItem(FS_FORCED_VARIATIONS);\n        if (keyCombinationPressed()) {\n            loadQaAssistant(config, null, visitorVariationState);\n        }\n    };\n    window.__flagshipSdkOnKeyCombinationUp = (event) => {\n        delete keysPressed[event.key];\n    };\n    document.addEventListener('keydown', window.__flagshipSdkOnKeyCombinationDown);\n    document.addEventListener('keyup', window.__flagshipSdkOnKeyCombinationUp);\n}\n","export function detectNavigationChanges(config, visitorVariationState, callback) {\n    if (window.__flagshipSdkOriginalPushState) {\n        window.history.pushState = window.__flagshipSdkOriginalPushState;\n    }\n    if (window.__flagshipSdkOriginalReplaceState) {\n        window.history.replaceState = window.__flagshipSdkOriginalReplaceState;\n    }\n    if (window.__flagshipSdkPopStateHandler) {\n        window.removeEventListener('popstate', window.__flagshipSdkPopStateHandler);\n    }\n    window.__flagshipSdkOriginalPushState = window.history.pushState;\n    window.__flagshipSdkOriginalReplaceState = window.history.replaceState;\n    function triggerCallback() {\n        if (config.isQAModeEnabled) {\n            visitorVariationState.navigationDetected = true;\n            callback?.();\n        }\n    }\n    window.history.pushState = function (...args) {\n        if (window.__flagshipSdkOriginalPushState) {\n            window.__flagshipSdkOriginalPushState.apply(this, args);\n            triggerCallback();\n        }\n    };\n    window.history.replaceState = function (...args) {\n        if (window.__flagshipSdkOriginalReplaceState) {\n            window.__flagshipSdkOriginalReplaceState.apply(this, args);\n            triggerCallback();\n        }\n    };\n    window.__flagshipSdkPopStateHandler = () => {\n        triggerCallback();\n    };\n    window.addEventListener('popstate', window.__flagshipSdkPopStateHandler);\n}\n","import { FS_QA_ASSISTANT, FS_QA_ASSISTANT_LOCAL, FS_QA_ASSISTANT_STAGING, QA_ASSISTANT_LOCAL_URL, QA_ASSISTANT_PROD_URL, QA_ASSISTANT_STAGING_URL, TAG_QA_ASSISTANT, TAG_QA_ASSISTANT_LOCAL, TAG_QA_ASSISTANT_STAGING, TRUSTED_QA_ORIGINS } from '../enum/FlagshipConstant';\nimport { isBrowser, onDomReady } from '../utils/utils';\nimport { listenForKeyboardQaAssistant } from './listenForKeyboardQaAssistant';\nimport { loadQaAssistant } from './loadQaAssistant';\nimport { detectNavigationChanges } from './detectNavigationChanges';\nimport { MSG_NAME_FROM_IFRAME } from './type';\n/**\n *\n * @param config\n * @returns\n */\nexport function launchQaAssistant(config, visitorVariationState) {\n    if (!isBrowser()) {\n        return;\n    }\n    onDomReady(() => {\n        const urlMap = {\n            [FS_QA_ASSISTANT]: QA_ASSISTANT_PROD_URL,\n            [TAG_QA_ASSISTANT]: QA_ASSISTANT_PROD_URL,\n            [FS_QA_ASSISTANT_STAGING]: QA_ASSISTANT_STAGING_URL,\n            [TAG_QA_ASSISTANT_STAGING]: QA_ASSISTANT_STAGING_URL,\n            [FS_QA_ASSISTANT_LOCAL]: QA_ASSISTANT_LOCAL_URL,\n            [TAG_QA_ASSISTANT_LOCAL]: QA_ASSISTANT_LOCAL_URL\n        };\n        const queryParam = new URLSearchParams(window.location.search);\n        const urlKey = Object.keys(urlMap).find((key) => queryParam.get(key) === 'true') || '';\n        if (window.__flagshipSdkOnPlatformChoiceLoaded) {\n            window.removeEventListener('message', window.__flagshipSdkOnPlatformChoiceLoaded);\n        }\n        function onPlatformChoiceLoaded(event) {\n            if (!TRUSTED_QA_ORIGINS.includes(event.origin)) {\n                return;\n            }\n            if (event.data.name === MSG_NAME_FROM_IFRAME.QaAssistantPlatformChoiceLoaded) {\n                if (!config.isQAModeEnabled) {\n                    loadQaAssistant(config, null, visitorVariationState);\n                }\n                window.removeEventListener('message', onPlatformChoiceLoaded);\n            }\n        }\n        window.__flagshipSdkOnPlatformChoiceLoaded = onPlatformChoiceLoaded;\n        window.addEventListener('message', window.__flagshipSdkOnPlatformChoiceLoaded);\n        detectNavigationChanges(config, visitorVariationState);\n        if (config.isQAModeEnabled || urlKey) {\n            loadQaAssistant(config, urlMap[urlKey], visitorVariationState);\n            return;\n        }\n        listenForKeyboardQaAssistant(config, visitorVariationState);\n    });\n}\n"],"names":[],"sourceRoot":""}